<!-- MHonArc v2.6.15 -->
<!--X-Subject: Re: Surrogates and character representation -->
<!--X-From-R13: orne <orneNfbavp.arg> -->
<!--X-Date: Wed, 27 Jul 2005 18:16:36 +0200 (DFT) -->
<!--X-Message-Id: Pine.LNX.4.58.0507270903120.2389@bolt.sonic.net -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: 1122002894.6607.29.camel@dev1.seyza.com -->
<!--X-Reference: 17120.28178.788826.533753@tiphares.basistech.net -->
<!--X-Reference: 20050722040917.GB7576@NYCMJCOWA2 -->
<!--X-Reference: 17120.30080.768671.539970@tiphares.basistech.net -->
<!--X-Reference: 878xzykn0y.fsf@becket.becket.net -->
<!--X-Reference: 17122.31220.22073.72951@tiphares.basistech.net -->
<!--X-Reference: 20050724053713.GM2784@NYCMJCOWA2 -->
<!--X-Reference: 42E3D086.90403@astrosmo.unam.mx -->
<!--X-Reference: 17123.54753.371934.424875@tiphares.basistech.net -->
<!--X-Reference: 42E3DD0C.5060108@bothner.com -->
<!--X-Reference: 20050724230151.GP2784@NYCMJCOWA2 -->
<!--X-Reference: 42E52020.8010409@astrosmo.unam.mx -->
<!--X-Head-End-->
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
        "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Re: Surrogates and character representation</title>
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<hr>
[<a href="msg00237.html">Date Prev</a>][<a href="msg00238.html">Date Next</a>][<a href="msg00234.html">Thread Prev</a>][<a href="msg00230.html">Thread Next</a>][<a href="maillist.html#00239">Date Index</a>][<a href="threads.html#00239">Thread Index</a>]
<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h1>Re: Surrogates and character representation</h1>
<p style="max-width: 30em;">This page is part of the web mail archives of <a href="http://srfi.schemers.org/srfi-75">SRFI 75</a> from before July 7th, 2015.  The new archives for SRFI 75 are <a href="http://srfi-email.schemers.org/srfi-75/">here</a>.  The new archives contain all messages, not just those from before July 7th, 2015.</p>
<hr>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul>
<li><em>To</em>: Alan Watson &lt;<a href="mailto:a.watson@DOMAIN.HIDDEN">a.watson@xxxxxxxxxxxxxxxx</a>&gt;</li>
<li><em>Subject</em>: Re: Surrogates and character representation</li>
<li><em>From</em>: bear &lt;<a href="mailto:bear@DOMAIN.HIDDEN">bear@xxxxxxxxx</a>&gt;</li>
<li><em>Date</em>: Wed, 27 Jul 2005 09:16:02 -0700 (PDT)</li>
<li><em>Cc</em>: &quot;John.Cowan&quot; &lt;<a href="mailto:jcowan@DOMAIN.HIDDEN">jcowan@xxxxxxxxxxxxxxxxx</a>&gt;,	Per Bothner &lt;<a href="mailto:per@DOMAIN.HIDDEN">per@xxxxxxxxxxx</a>&gt;, <a href="mailto:srfi-75@DOMAIN.HIDDEN">srfi-75@xxxxxxxxxxxxxxxxx</a></li>
<li><em>Delivered-to</em>: <a href="mailto:srfi-75@DOMAIN.HIDDEN">srfi-75@xxxxxxxxxxxxxxxxx</a></li>
<li><em>In-reply-to</em>: &lt;<a href="mailto:42E52020.8010409@DOMAIN.HIDDEN">42E52020.8010409@xxxxxxxxxxxxxxxx</a>&gt;</li>
<li><em>References</em>: &lt;<a href="mailto:1122002894.6607.29.camel@DOMAIN.HIDDEN">1122002894.6607.29.camel@xxxxxxxxxxxxxx</a>&gt; &lt;<a href="mailto:17120.28178.788826.533753@DOMAIN.HIDDEN">17120.28178.788826.533753@xxxxxxxxxxxxxxxxxxxxxx</a>&gt; &lt;<a href="mailto:20050722040917.GB7576@DOMAIN.HIDDEN"><a href="msg00190.html">20050722040917.GB7576@NYCMJCOWA2</a></a>&gt; &lt;<a href="mailto:17120.30080.768671.539970@DOMAIN.HIDDEN">17120.30080.768671.539970@xxxxxxxxxxxxxxxxxxxxxx</a>&gt; &lt;<a href="mailto:878xzykn0y.fsf@DOMAIN.HIDDEN">878xzykn0y.fsf@xxxxxxxxxxxxxxxxx</a>&gt; &lt;<a href="mailto:17122.31220.22073.72951@DOMAIN.HIDDEN">17122.31220.22073.72951@xxxxxxxxxxxxxxxxxxxxxx</a>&gt; &lt;<a href="mailto:20050724053713.GM2784@DOMAIN.HIDDEN"><a href="msg00219.html">20050724053713.GM2784@NYCMJCOWA2</a></a>&gt; &lt;<a href="mailto:42E3D086.90403@DOMAIN.HIDDEN">42E3D086.90403@xxxxxxxxxxxxxxxx</a>&gt; &lt;<a href="mailto:17123.54753.371934.424875@DOMAIN.HIDDEN">17123.54753.371934.424875@xxxxxxxxxxxxxxxxxxxxxx</a>&gt; &lt;<a href="mailto:42E3DD0C.5060108@DOMAIN.HIDDEN">42E3DD0C.5060108@xxxxxxxxxxx</a>&gt; &lt;<a href="mailto:20050724230151.GP2784@DOMAIN.HIDDEN"><a href="msg00231.html">20050724230151.GP2784@NYCMJCOWA2</a></a>&gt; &lt;<a href="mailto:42E52020.8010409@DOMAIN.HIDDEN">42E52020.8010409@xxxxxxxxxxxxxxxx</a>&gt;</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
<hr>
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre>

On Mon, 25 Jul 2005, Alan Watson wrote:

&gt;Files actually provide a fairly close analogy to the commonest means of
&gt;representing Unicode strings.
&gt;
&gt;Imagine a file system that implements files as streams of bytes. Now
&gt;imagine that you want to read the Nth *line*. The only way to do this is
&gt;to read through the file until you have encounted N-1 newlines. This is
&gt;like finding the Nth character when using UTF-8 for strings.
&gt;
&gt;Now imagine a file system that implements files as enumerated
&gt;random-access records and uses exactly one record for each line. You can
&gt;directly read the Nth line. This is like finding the Nth character when
&gt;using UCS-32 for strings.
&gt;
&gt;Now imagine a file system that implements files as enumerated
&gt;random-access records and uses one or more record for each line. This is
&gt;like using UTF-16 for strings.

FWIW, I'm representing strings as trees, where each
branch of the tree records how many units are contained
within the leaves depending from that branch.  Initially
my only units were grapheme clusters, but now I keep
track of newlines and codepoints as well.

So, it's possible to navigate the triple-indexed tree by
any of the three indexes (codepints, graphemes, or lines)
and get to the right leaf.  Of course, having gotten
there, you may need to count from the beginning of the
leaf buffer to get to exactly where you wanted to be.
The result is that it's not actual constant-time random
access, but it's log(n) access in any of the reasonable
indexes. One important thing is that the size of the leaf
buffers is strictly limited to 1020 codepoints or less.
You don't have to start counting from the beginning of
the string.  Another is that different leaves can use
different fixed-width representations:  Latin1, BMP,
or UTF-32 depending on what is the widest codepoint in
that leaf's buffer.  In practice, 99% or more of every
long string is represented in ascii/Latin1.

I think a lot of people won't want to do this, but my
point is that it is possible to strike a good compromise
and multi-index your strings so that you can have fast
access in any of several representations.

				Bear

</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
<hr>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00187" href="msg00187.html">Re: the &quot;Unicode Background&quot; section</a></strong>
<ul><li><em>From:</em> Thomas Lord</li></ul></li>
<li><strong><a name="00189" href="msg00189.html">Surrogates and character representation</a></strong>
<ul><li><em>From:</em> Tom Emerson</li></ul></li>
<li><strong><a name="00190" href="msg00190.html">Re: Surrogates and character representation</a></strong>
<ul><li><em>From:</em> John.Cowan</li></ul></li>
<li><strong><a name="00192" href="msg00192.html">Re: Surrogates and character representation</a></strong>
<ul><li><em>From:</em> Tom Emerson</li></ul></li>
<li><strong><a name="00213" href="msg00213.html">Re: Surrogates and character representation</a></strong>
<ul><li><em>From:</em> Thomas Bushnell BSG</li></ul></li>
<li><strong><a name="00215" href="msg00215.html">Re: Surrogates and character representation</a></strong>
<ul><li><em>From:</em> Tom Emerson</li></ul></li>
<li><strong><a name="00219" href="msg00219.html">Re: Surrogates and character representation</a></strong>
<ul><li><em>From:</em> John.Cowan</li></ul></li>
<li><strong><a name="00224" href="msg00224.html">Re: Surrogates and character representation</a></strong>
<ul><li><em>From:</em> Alan Watson</li></ul></li>
<li><strong><a name="00225" href="msg00225.html">Re: Surrogates and character representation</a></strong>
<ul><li><em>From:</em> Tom Emerson</li></ul></li>
<li><strong><a name="00227" href="msg00227.html">Re: Surrogates and character representation</a></strong>
<ul><li><em>From:</em> Per Bothner</li></ul></li>
<li><strong><a name="00231" href="msg00231.html">Re: Surrogates and character representation</a></strong>
<ul><li><em>From:</em> John.Cowan</li></ul></li>
<li><strong><a name="00234" href="msg00234.html">Re: Surrogates and character representation</a></strong>
<ul><li><em>From:</em> Alan Watson</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
<ul>
<li>Prev by Date:
<strong><a href="msg00237.html">Re: Surrogates and character representation</a></strong>
</li>
<li>Next by Date:
<strong><a href="msg00238.html">Re: Surrogates and character representation</a></strong>
</li>
<li>Previous by thread:
<strong><a href="msg00234.html">Re: Surrogates and character representation</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg00230.html">Re: Surrogates and character representation</a></strong>
</li>
<li>Index(es):
<ul>
<li><a href="maillist.html#00239"><strong>Date</strong></a></li>
<li><a href="threads.html#00239"><strong>Thread</strong></a></li>
</ul>
</li>
</ul>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
</body>
</html>
