<!-- MHonArc v2.6.15 -->
<!--X-Subject: Re: Floating&#45;point formats and standards -->
<!--X-From-R13: "Penqq I. Embalr" <oenqq+fesvNfmbalr.pbz> -->
<!--X-Date: Fri,  7 Jan 2005 13:51:16 +0100 (NFT) -->
<!--X-Message-Id: 20050107125109.GB18722@ogre.szonye.com -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: Pine.LNX.4.58.0412301550550.3862@bolt.sonic.net -->
<!--X-Reference: 20050105012438.GD6573@ogre.szonye.com -->
<!--X-Reference: 20050105055413.5FA901B7717@voluntocracy.org -->
<!--X-Reference: 20050105114809.GB9007@ogre.szonye.com -->
<!--X-Reference: 20050105122227.GC9007@ogre.szonye.com -->
<!--X-Reference: 20050105170342.348AC1B7719@voluntocracy.org -->
<!--X-Reference: 20050106004956.GB10975@ogre.szonye.com -->
<!--X-Reference: 20050106060805.D2EEC1B7727@voluntocracy.org -->
<!--X-Reference: 20050106104820.GA14471@ogre.szonye.com -->
<!--X-Reference: 20050107041723.207071B7727@voluntocracy.org -->
<!--X-Head-End-->
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
        "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Re: Floating-point formats and standards</title>
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<hr>
[<a href="msg00104.html">Date Prev</a>][<a href="msg00106.html">Date Next</a>][<a href="msg00103.html">Thread Prev</a>][<a href="msg00109.html">Thread Next</a>][<a href="maillist.html#00105">Date Index</a>][<a href="threads.html#00105">Thread Index</a>]
<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h1>Re: Floating-point formats and standards</h1>
<p style="max-width: 30em;">This page is part of the web mail archives of <a href="http://srfi.schemers.org/srfi-58">SRFI 58</a> from before July 7th, 2015.  The <a href="http://srfi-email.schemers.org/srfi-58">new archives</a> for SRFI 58 contain all messages, not just those from before July 7th, 2015.</p>
<hr>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul>
<li><em>To</em>: <a href="mailto:srfi-58@DOMAIN.HIDDEN">srfi-58@xxxxxxxxxxxxxxxxx</a></li>
<li><em>Subject</em>: Re: Floating-point formats and standards</li>
<li><em>From</em>: &quot;Bradd W. Szonye&quot; &lt;<a href="mailto:bradd%2Bsrfi@DOMAIN.HIDDEN">bradd+srfi@xxxxxxxxxx</a>&gt;</li>
<li><em>Date</em>: Fri, 7 Jan 2005 04:51:09 -0800</li>
<li><em>Delivered-to</em>: <a href="mailto:srfi-58@DOMAIN.HIDDEN">srfi-58@xxxxxxxxxxxxxxxxx</a></li>
<li><em>In-reply-to</em>: &lt;<a href="mailto:20050107041723.207071B7727@DOMAIN.HIDDEN">20050107041723.207071B7727@xxxxxxxxxxxxxxxx</a>&gt;</li>
<li><em>Mail-followup-to</em>: <a href="mailto:srfi-58@DOMAIN.HIDDEN">srfi-58@xxxxxxxxxxxxxxxxx</a></li>
<li><em>References</em>: &lt;<a href="mailto:Pine.LNX.4.58.0412301550550.3862@DOMAIN.HIDDEN">Pine.LNX.4.58.0412301550550.3862@xxxxxxxxxxxxxx</a>&gt; &lt;<a href="mailto:20050105012438.GD6573@DOMAIN.HIDDEN">20050105012438.GD6573@xxxxxxxxxxxxxxx</a>&gt; &lt;<a href="mailto:20050105055413.5FA901B7717@DOMAIN.HIDDEN">20050105055413.5FA901B7717@xxxxxxxxxxxxxxxx</a>&gt; &lt;<a href="mailto:20050105114809.GB9007@DOMAIN.HIDDEN">20050105114809.GB9007@xxxxxxxxxxxxxxx</a>&gt; &lt;<a href="mailto:20050105122227.GC9007@DOMAIN.HIDDEN">20050105122227.GC9007@xxxxxxxxxxxxxxx</a>&gt; &lt;<a href="mailto:20050105170342.348AC1B7719@DOMAIN.HIDDEN">20050105170342.348AC1B7719@xxxxxxxxxxxxxxxx</a>&gt; &lt;<a href="mailto:20050106004956.GB10975@DOMAIN.HIDDEN">20050106004956.GB10975@xxxxxxxxxxxxxxx</a>&gt; &lt;<a href="mailto:20050106060805.D2EEC1B7727@DOMAIN.HIDDEN">20050106060805.D2EEC1B7727@xxxxxxxxxxxxxxxx</a>&gt; &lt;<a href="mailto:20050106104820.GA14471@DOMAIN.HIDDEN">20050106104820.GA14471@xxxxxxxxxxxxxxx</a>&gt; &lt;<a href="mailto:20050107041723.207071B7727@DOMAIN.HIDDEN">20050107041723.207071B7727@xxxxxxxxxxxxxxxx</a>&gt;</li>
<li><em>User-agent</em>: Mutt/1.4.1i</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
<hr>
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre>Brief summary: More praise, a few minor suggestions, and one major issue.

Bradd wrote:
&gt;&gt; Would you mind terribly making the A optional in the second syntax?
&gt;&gt; 
&gt;&gt;     array-prefix :: rank  `A'  [ dimensions ] [ `:' type-specifier ]
&gt;&gt;                   |      [`A']   dimensions   [ `:' type-specifier ]
&gt;&gt; 
&gt;&gt; I realize that it complicates parsing a bit ....

Aubrey Jaffer wrote:
&gt; It took several hours to code, but it seems to work.

Great!

I thought of two more items for the syntax examples.

1. They should include examples of how to write arrays with empty
   dimensions. (I hope I got all these right.)
   
   #A0*2()
   #A2*0(() ()).
   #A2*0*3(() ()).
   #A2*3*0((() () ()) (() () ())).

2. It should be an error to write any array with inconsistent or
   ambiguous rank or dimension specifiers.

   #3A()           array shape is ambiguous
   #2A((1 2) (1))  column widths are inconsistent
   #3A1*1((1))     rank is inconsistent with dimension specifier

&gt;&gt; ... but it also unifies the dimension syntax with the #n(...) vector
&gt;&gt; syntax of Common Lisp and PLT Scheme.

&gt; Can you describe the PLT compatibility?

PLT Scheme implements the Common Lisp #n(...) syntax with two extensions.

In Common Lisp, #n(v.1 v.2 ... v.k) creates a vector of size N, with the
final value, v.k, repeated (N - K) times. It's an error if (K &gt; N) or if
(K = 0 and N &gt; 0). Examples:

    #5(1 2) ==&gt; #(1 2 2 2 2)
    #2(1 2) ==&gt; #(1 2)
    #0()    ==&gt; #()
    #1(1 2) ==&gt; error: too many values
    #5()    ==&gt; error: no values for non-empty array

PLT Scheme adds two extensions: If (K = 0), the vector is filled with 0,
and if (K &gt; N) the reader raises a specific exception. If &quot;it is an
error&quot; means the same thing in Common Lisp as it does in Scheme, these
are pure extensions of the CL feature.

With the &quot;A&quot; optional, the array literal syntax is consistent with
CL/PLT: #3(1 2 3) == #A3(1 2 3) == #1A3(1 2 3) == #1A(1 2 3).

&gt;&gt; Don't forget to give semantics and examples for the shaped-array
&gt;&gt; syntax.  I don't particularly care whether you define the repeat-fill
&gt;&gt; rule; feel free to leave it for a later SRFI if you don't want to
&gt;&gt; write it up.

&gt; Do whole rows, planes, etc also repeat?

I would expect it.

First, repeat the last object in each column as many times as necessary
to fill it. Then repeat the last column in each row, the last row in
each super-row, and so on, until the array is complete.

For example, consider this 4*4 matrix:

    | 1 2 3 3 |
    | 2 2 3 3 |
    | 3 3 3 3 |
    | 3 3 3 3 |

You could write this as:

    #4*4((1 2 3) (2 2 3) (3))

The reader would first complete each column:

    #4*4((1 2 3 3) (2 2 3 3) (3 3 3 3))

Then each row:

    #4*4((1 2 3 3) (2 2 3 3) (3 3 3 3) (3 3 3 3))

Obviously, this works best (typing-wise) for arrays that only vary near
the origin. While it would be nice to have a more general shorthand --
especially something that could handle identity matrices -- that's a
better subject for a later SRFI.

(Here's an idea in case somebody does want to implement an extension
like that. In the list decomposition, an exact integer M indicates that
the following row should be repeated M times, and an ellipsis indicates
that the preceding row or column should be repeated as many times as
necessary to complete the dimension. For example,

    #100x100(2(1 ...) (1 1 0 ... 1 1) ... 2(1 ...))

describes a 100x100 matrix with a border of two 1s surround a zero
center. I don't recommend it for this SRFI; it's too big of an
enhancement. I don't even mind if you also punt on the basic CL/PLT
tail-filling feature. Only do this if you're sure it's a good idea and
you really want to implement it.)

&gt;&gt; Anybody feel strongly about &quot;*&quot; vs &quot;x&quot; for the bound separator?

&gt; I don't like x because it looks like mistyped hex numbers (#x33)

OK, that's good enough for me.

&gt;&gt; That covers all of the basic types.  Only binaryx [x86] is missing ....

&gt; I think you will find that vectorized instructions don't pack
&gt; non-power-of-2 bit widths.  Breaking operands over cache-line
&gt; boundaries is a huge hassle for hardware.
&gt; 
&gt; So the 80-bit and 96-bit are likely stored into 128 bits.  We might as
&gt; well call them 128b.

Ah, OK. That's good enough for now, since I know of no implementations
with both x86 and quad flonums. I suppose it could happen in the future,
if Intel keeps binaryx and adds binary128, but that's probably 5 to 10
years off, if it happens at all. If it ever becomes a problem, it
wouldn't be hard to add flox96b specifiers.

&gt; This text I added describes how sizes are chosen:
&gt;
&gt;   Implementations are required to accept all of the type denotations.
&gt;   Uniform types of matching sizes which the platform supports will be
&gt;   used; the others will be represented as the next larger format of
&gt;   the same type implemented.  If there is no larger format of the same
&gt;   type and there is a bignum format for that element type, then the
&gt;   array format defaults to vector; otherwise the largest uniform
&gt;   format of that type is used.

I'll try an example to make sure I understand the intent correctly.
Suppose that I'm targeting all the machines in an HP data center
(a mix of x86, Itanium, and PA-RISC).

    flor128b =&gt; x86 extended (binaryx) on x86 and Itanium
    flor16b  =&gt; IEEE single (binary32) on all three systems
    fixz64b  =&gt; bignum on x86, or signed32 if there are no bignums

I have one major issues with the rule as written above: It's not clear
what to do if the system lacks a flonum format altogehter. For example,
if you have no decimal flonums at all, you should probably use rational
bignums instead (because binary flonums are unacceptable for the major
decnum applications). However, if rational bignums are allowed as a
&quot;flonum&quot; format, then the rule above would prefer them over binaryx.

The essential problem here is that flonum, decnum, and fixnum typically
have different requirements. In general, precision and range are non-
negotiable for fixnums and decnums: Users only specify the large types
when the data requires it. However, speed is usually more important than
precision for binary flonums.

It might be best to specify each major element type separately. Here are
my recommendations for defaults when there's format large enough. Each
offers a list of acceptable possibilities, roughly in order from most to
least desirable. An implementation should document its behavior (and
should allow users to reconfigure that behavior).

Binary flonum (floTWb)
a. largest available binary flonum
b. arbitrary-precision floating-point number (a &quot;floating-point bignum&quot;)
c. rational bignum
d. none (signal an error)

Decimal flonum (floTWd)
a. arbitrary-precision floating-point number
b. rational bignum
c. binary flonum with at least 2W precision
d. none (signal an error)
e. largest available decimal flonum

Fixnum (fixTWb)
a. flonum with at least W bits precision in the significand
b. bignum
c. none (signal an error)

&gt;&gt; No fixq arrays for rational numbers?  C'mon, you know you want to!

&gt; Although the syntax could easily specify arbitrary precisions, the
&gt; prototype functions would need to take extra arguments.  Should the
&gt; precision be specified as total bits and fractional bits; or integral
&gt; bits and fractional bits?

Oh, I figured they'd work like complex numbers, e.g., a fixq32b would
have a 32-bit numerator and a 32-bit denominator. (That is how complex
numbers work, right?)

&gt; It is the Swiss-army-knife of array syntax.  I hope the R6RS editors
&gt; are okay with that.

Well, I like it. There are a couple issues to work out, but I'm very
happy with the spec overall.
-- 
Bradd W. Szonye
<a  rel="nofollow" href="http://www.szonye.com/bradd">http://www.szonye.com/bradd</a>

</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
<hr>
<ul><li><strong>Follow-Ups</strong>:
<ul>
<li><strong><a name="00109" href="msg00109.html">Re: Floating-point formats and standards</a></strong>
<ul><li><em>From:</em> Aubrey Jaffer</li></ul></li>
</ul></li></ul>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00007" href="msg00007.html">Re: #\a octothorpe syntax vs SRFI 10</a></strong>
<ul><li><em>From:</em> bear</li></ul></li>
<li><strong><a name="00068" href="msg00068.html">Re: #\a octothorpe syntax vs SRFI 10</a></strong>
<ul><li><em>From:</em> Bradd W. Szonye</li></ul></li>
<li><strong><a name="00084" href="msg00084.html">Re: #\a octothorpe syntax vs SRFI 10</a></strong>
<ul><li><em>From:</em> Aubrey Jaffer</li></ul></li>
<li><strong><a name="00087" href="msg00087.html">Floating-point formats and standards</a></strong>
<ul><li><em>From:</em> Bradd W. Szonye</li></ul></li>
<li><strong><a name="00088" href="msg00088.html">Re: Floating-point formats and standards</a></strong>
<ul><li><em>From:</em> Bradd W. Szonye</li></ul></li>
<li><strong><a name="00096" href="msg00096.html">Re: Floating-point formats and standards</a></strong>
<ul><li><em>From:</em> Aubrey Jaffer</li></ul></li>
<li><strong><a name="00098" href="msg00098.html">Re: Floating-point formats and standards</a></strong>
<ul><li><em>From:</em> Bradd W. Szonye</li></ul></li>
<li><strong><a name="00101" href="msg00101.html">Re: Floating-point formats and standards</a></strong>
<ul><li><em>From:</em> Aubrey Jaffer</li></ul></li>
<li><strong><a name="00102" href="msg00102.html">Re: Floating-point formats and standards</a></strong>
<ul><li><em>From:</em> Bradd W. Szonye</li></ul></li>
<li><strong><a name="00103" href="msg00103.html">Re: Floating-point formats and standards</a></strong>
<ul><li><em>From:</em> Aubrey Jaffer</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
<ul>
<li>Prev by Date:
<strong><a href="msg00104.html">Re: Floating-point formats and standards</a></strong>
</li>
<li>Next by Date:
<strong><a href="msg00106.html">Scheme flonum literals</a></strong>
</li>
<li>Previous by thread:
<strong><a href="msg00103.html">Re: Floating-point formats and standards</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg00109.html">Re: Floating-point formats and standards</a></strong>
</li>
<li>Index(es):
<ul>
<li><a href="maillist.html#00105"><strong>Date</strong></a></li>
<li><a href="threads.html#00105"><strong>Thread</strong></a></li>
</ul>
</li>
</ul>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
</body>
</html>
