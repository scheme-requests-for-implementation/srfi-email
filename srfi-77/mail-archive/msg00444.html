<!-- MHonArc v2.6.15 -->
<!--X-Subject: Re: fixnumXXX and fxXXX names, and other things -->
<!--X-From-R13: [nep Trryrl <srryrlNveb.hzbagerny.pn> -->
<!--X-Date: Mon, 19 Jun 2006 07:00:36 +0200 (MST) -->
<!--X-Message-Id: F4DF3177&#45;5E2E&#45;40E6&#45;ABBE&#45;EE0240D39B52@iro.umontreal.ca -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: E1Fs1Ml&#45;0005XJ&#45;2t@adara.ccs.neu.edu -->
<!--X-Head-End-->
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
        "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Re: fixnumXXX and fxXXX names, and other things</title>
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<hr>
[<a href="msg00443.html">Date Prev</a>][<a href="msg00445.html">Date Next</a>][<a href="msg00442.html">Thread Prev</a>][<a href="msg00445.html">Thread Next</a>][<a href="maillist.html#00444">Date Index</a>][<a href="threads.html#00444">Thread Index</a>]
<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h1>Re: fixnumXXX and fxXXX names, and other things</h1>
<p style="max-width: 30em;">This page is part of the web mail archives of <a href="http://srfi.schemers.org/srfi-77">SRFI 77</a> from before July 7th, 2015.  The new archives for SRFI 77 are <a href="http://srfi-email.schemers.org/srfi-77/">here</a>.  Eventually, the entire history will be moved there, including any new messages.</p>
<hr>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul>
<li><em>To</em>: William D Clinger &lt;<a href="mailto:will@DOMAIN.HIDDEN">will@xxxxxxxxxxx</a>&gt;</li>
<li><em>Subject</em>: Re: fixnumXXX and fxXXX names, and other things</li>
<li><em>From</em>: Marc Feeley &lt;<a href="mailto:feeley@DOMAIN.HIDDEN">feeley@xxxxxxxxxxxxxxxx</a>&gt;</li>
<li><em>Date</em>: Mon, 19 Jun 2006 01:00:08 -0400</li>
<li><em>Cc</em>: <a href="mailto:srfi-77@DOMAIN.HIDDEN">srfi-77@xxxxxxxxxxxxxxxxx</a></li>
<li><em>Delivered-to</em>: <a href="mailto:srfi-77@DOMAIN.HIDDEN">srfi-77@xxxxxxxxxxxxxxxxx</a></li>
<li><em>In-reply-to</em>: &lt;<a href="mailto:E1Fs1Ml-0005XJ-2t@DOMAIN.HIDDEN">E1Fs1Ml-0005XJ-2t@xxxxxxxxxxxxxxxxx</a>&gt;</li>
<li><em>References</em>: &lt;<a href="mailto:E1Fs1Ml-0005XJ-2t@DOMAIN.HIDDEN">E1Fs1Ml-0005XJ-2t@xxxxxxxxxxxxxxxxx</a>&gt;</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
<hr>
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre style="margin: 0em;">
On 18-Jun-06, at 1:47 PM, William D Clinger wrote:

</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">
Concerning duplicate names for operations such as fixnum&lt; and fx&lt;,
Marc Feeley wrote:
</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">
What is the rationale for all this duplication?
</pre></blockquote><pre style="margin: 0em;">

See the second rationale in the Fixnums section.
</pre></blockquote><pre style="margin: 0em;">

</pre><tt>The rationale for the two sets of names is wrong.  Adding redundant  
</tt><tt>procedures adds confusion.  For the trivial reason of avoiding bias  
</tt><tt>toward either set of names the SRFI introduces 30 redundant  
</tt><tt>bindings.  These bindings have a cost in additional global variables,  
</tt><tt>and in a system with precise error messages you actually need  
</tt><tt>different procedures for the fixnumXXX and fxXXX procedures so that  
</tt><tt>the error messages can indicate the name of the procedure that  
</tt><tt>appears in the user program.  Also, as I said in my previous message,  
</tt><tt>the prefixes &quot;fixnum&quot; and &quot;fx&quot; give no clue to the nature of these  
</tt><tt>operations (to me &quot;fixnum&quot; and &quot;fx&quot; are synonyms, better prefixes  
</tt><tt>would be &quot;fxring&quot; and &quot;fx&quot;), so it is hard for the programmer to  
</tt><tt>determine which one is the correct one to use.
</tt><pre style="margin: 0em;">

</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">
The main motivation for fixnum specific operations is that
they are much faster than generic arithmetic.
</pre></blockquote><pre style="margin: 0em;">

That is one motivation, and for some people it may be the
main motivation, but it is not everyone's main motivation.
</pre></blockquote><pre style="margin: 0em;">

</pre><tt>I didn't make this up.  It is the only rationale for fixnums in the  
</tt><tt>SRFI 77 rationale:
</tt><pre style="margin: 0em;">

</pre><tt>  Fixnum/flonum arithmetic is already supported by many systems,  
</tt><tt>mainly for efficiency.
</tt><tt>  Standardization of fixnum/flonum arithmetic would increase the  
</tt><tt>portability of code that uses
</tt><tt>  it, but we cannot standardize the precision of fixnum/flonum  
</tt><tt>arithmetic without making it
</tt><pre style="margin: 0em;">
  inefficient on some systems, which would defeat its purpose.

Is there another rationale for fixnums?

</pre><tt>By using a multiple values API for some fixnum operations, you are  
</tt><tt>limiting the practical portability of those operations.  This is  
</tt><tt>inconsistent with the rationale.  I repeat: in which implementations  
</tt><tt>of Scheme will the multiple values API be faster than the equivalent  
</tt><tt>pair of operations which return single values?  I believe that  
</tt><tt>efficient implementations of multiple values based on Ashley and  
</tt><tt>Dybvig's method (&quot;An Efficient Implementation of Multiple Values in  
</tt><tt>Scheme&quot; paper) will not gain with the MV API because they need to  
</tt><tt>return the multiple values using a function call, and the overhead of  
</tt><tt>the function call will drown the few machine cycles saved by the  
</tt><tt>combined operation.  The choice of a MV API for these operations is  
</tt><tt>poor engineering.
</tt><pre style="margin: 0em;">

</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">
But in many implementations of Scheme multiple values are
rather slow...
</pre></blockquote><pre style="margin: 0em;">

Presumably the operations that return multiple values will
be slow in those implementations.  Those who regard efficiency
as the main motivation for those operations might want to
avoid implementations in which multiple values are slow.
</pre></blockquote><pre style="margin: 0em;">

This view contradicts the rationale.

</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">
Finally, I haven't counted the number of procedures defined
in this SRFI, but it is clearly very high.  Do you
realistically think that current implementations of Scheme
will be updated to implement all these procedures efficiently?
</pre></blockquote><pre style="margin: 0em;">

Inasmuch as most current implementations have not yet gotten
around to implementing all of the R5RS procedures efficiently,
it would surprise me if they were to implement all of the R6RS
procedures efficiently.
</pre></blockquote><pre style="margin: 0em;">

</pre><tt>My point is that this high barrier to entry will result in poor  
</tt><tt>portability in practice.  The prospects for portable and efficient  
</tt><tt>arithmetic in Scheme would be greatly enhanced if the set of  
</tt><tt>procedures to implement efficiently was small, because more  
</tt><tt>implementations of Scheme would be willing to put the effort required  
</tt><tt>to implement them.  I have strong reservations about SRFI 77's  
</tt><tt>&quot;everything but the kitchen sink&quot; approach.  As an implementer, let  
</tt><tt>me say that after all the effort put into the Gambit-C numerical  
</tt><tt>library (roughly 8000 lines of Scheme code, with several fancy  
</tt><tt>algorithms for bignum operations, representing months of work) I find  
</tt><tt>SRFI 77's complexity to be a real turn-off when I consider the  
</tt><tt>changes required to implement it properly.  Surely I'm not the only  
</tt><tt>implementer to feel this way.
</tt><pre style="margin: 0em;">

</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">

</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">
Can we expect a portable and reasonably efficient implementation
of this SRFI to be written as the reference implementation?
</pre></blockquote><pre style="margin: 0em;">

Yes.  I'm working on it.

A relatively small subset of the fixnum and flonum procedures
will be identified as the basic primitives.  If implementors
implement those primitives efficiently, they will be rewarded
with a reasonably efficient implementation of the full SRFI.
</pre></blockquote><pre style="margin: 0em;">

</pre><tt>Can you quantify what you mean by &quot;reasonably efficient&quot; for the  
</tt><tt>fixnum operations?  Do you mean as fast as the equivalent operation  
</tt><tt>in C?  Or maybe 2 times slower (which would still be reasonably  
</tt><tt>efficient in my opinion)?  I fear that unless the fixnum operations  
</tt><tt>are inlined, the procedure call to the definition in the reference  
</tt><tt>implementation will slow down the operation by a factor of 10 or  
</tt><tt>more, rendering it useless in practice for writing efficient code.
</tt><pre style="margin: 0em;">

Marc

</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
<hr>
<ul><li><strong>Follow-Ups</strong>:
<ul>
<li><strong><a name="00445" href="msg00445.html">Re: fixnumXXX and fxXXX names, and other things</a></strong>
<ul><li><em>From:</em> Per Bothner</li></ul></li>
</ul></li></ul>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00441" href="msg00441.html">Re: fixnumXXX and fxXXX names, and other things</a></strong>
<ul><li><em>From:</em> William D Clinger</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
<ul>
<li>Prev by Date:
<strong><a href="msg00443.html">Re: fixnumXXX and fxXXX names, and other things</a></strong>
</li>
<li>Next by Date:
<strong><a href="msg00445.html">Re: fixnumXXX and fxXXX names, and other things</a></strong>
</li>
<li>Previous by thread:
<strong><a href="msg00442.html">Re: fixnumXXX and fxXXX names, and other things</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg00445.html">Re: fixnumXXX and fxXXX names, and other things</a></strong>
</li>
<li>Index(es):
<ul>
<li><a href="maillist.html#00444"><strong>Date</strong></a></li>
<li><a href="threads.html#00444"><strong>Thread</strong></a></li>
</ul>
</li>
</ul>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
</body>
</html>
