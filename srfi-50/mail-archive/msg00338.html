<!-- MHonArc v2.6.15 -->
<!--X-Subject: Re: Couple things... -->
<!--X-From-R13: orne <orneNfbavp.arg> -->
<!--X-Date: Sun, 18 Jan 2004 22:09:32 +0100 (MET) -->
<!--X-Message-Id: Pine.LNX.4.58.0401181217090.27105@bolt.sonic.net -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: opr0lf0hi7w2xcd0@mx.freenet.de -->
<!--X-Reference: y9lvfo7lwhn.fsf@informatik.uni&#45;tuebingen.de -->
<!--X-Reference: opr0oqxxx7w2xcd0@mx.freenet.de -->
<!--X-Reference: y9lsmj7boet.fsf@informatik.uni&#45;tuebingen.de -->
<!--X-Reference: opr0uv14oqw2xcd0@mx.freenet.de -->
<!--X-Reference: y9lsmj5jnud.fsf@informatik.uni&#45;tuebingen.de -->
<!--X-Reference: opr00jz3dhw2xcd0@mx.freenet.de -->
<!--X-Reference: y9lwu89ui2y.fsf@informatik.uni&#45;tuebingen.de -->
<!--X-Reference: Pine.LNX.4.58.0401031126470.14953@bolt.sonic.net -->
<!--X-Reference: vt2zncyhmog.fsf@zenia.home -->
<!--X-Reference: Pine.LNX.4.58.0401080750010.2668@bolt.sonic.net -->
<!--X-Reference: y9lk73q36tj.fsf@informatik.uni&#45;tuebingen.de -->
<!--X-Reference: Pine.LNX.4.58.0401172152370.12895@bolt.sonic.net -->
<!--X-Reference: y9lr7xxzhjr.fsf@informatik.uni&#45;tuebingen.de -->
<!--X-Reference: 200401181621.IAA00813@morrowfield.regexps.com -->
<!--X-Head-End-->
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
        "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Re: Couple things...</title>
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<hr>
[<a href="msg00337.html">Date Prev</a>][<a href="msg00339.html">Date Next</a>][<a href="msg00337.html">Thread Prev</a>][<a href="msg00339.html">Thread Next</a>][<a href="maillist.html#00338">Date Index</a>][<a href="threads.html#00338">Thread Index</a>]
<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h1>Re: Couple things...</h1>
<p style="max-width: 30em;">This page is part of the web mail archives of <a href="http://srfi.schemers.org/srfi-50">SRFI 50</a> from before July 7th, 2015.  The new archives for SRFI 50 are <a href="http://srfi-email.schemers.org/srfi-50/">here</a>.  The new archives contain all messages, not just those from before July 7th, 2015.</p>
<hr>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul>
<li><em>To</em>: Tom Lord &lt;<a href="mailto:lord@DOMAIN.HIDDEN">lord@xxxxxxx</a>&gt;</li>
<li><em>Subject</em>: Re: Couple things...</li>
<li><em>From</em>: bear &lt;<a href="mailto:bear@DOMAIN.HIDDEN">bear@xxxxxxxxx</a>&gt;</li>
<li><em>Date</em>: Sun, 18 Jan 2004 13:09:21 -0800 (PST)</li>
<li><em>Cc</em>: <a href="mailto:sperber@DOMAIN.HIDDEN">sperber@xxxxxxxxxxxxxxxxxxxxxxxxxxx</a>, <a href="mailto:srfi-50@DOMAIN.HIDDEN">srfi-50@xxxxxxxxxxxxxxxxx</a></li>
<li><em>Delivered-to</em>: <a href="mailto:srfi-50@DOMAIN.HIDDEN">srfi-50@xxxxxxxxxxxxxxxxx</a></li>
<li><em>In-reply-to</em>: &lt;<a href="mailto:200401181621.IAA00813@DOMAIN.HIDDEN">200401181621.IAA00813@xxxxxxxxxxxxxxxxxxxxxxx</a>&gt;</li>
<li><em>References</em>: &lt;<a href="mailto:opr0lf0hi7w2xcd0@DOMAIN.HIDDEN">opr0lf0hi7w2xcd0@xxxxxxxxxxxxx</a>&gt; &lt;<a href="mailto:y9lvfo7lwhn.fsf@DOMAIN.HIDDEN">y9lvfo7lwhn.fsf@xxxxxxxxxxxxxxxxxxxxxxxxxxx</a>&gt; &lt;<a href="mailto:opr0oqxxx7w2xcd0@DOMAIN.HIDDEN">opr0oqxxx7w2xcd0@xxxxxxxxxxxxx</a>&gt; &lt;<a href="mailto:y9lsmj7boet.fsf@DOMAIN.HIDDEN">y9lsmj7boet.fsf@xxxxxxxxxxxxxxxxxxxxxxxxxxx</a>&gt; &lt;<a href="mailto:opr0uv14oqw2xcd0@DOMAIN.HIDDEN">opr0uv14oqw2xcd0@xxxxxxxxxxxxx</a>&gt; &lt;<a href="mailto:y9lsmj5jnud.fsf@DOMAIN.HIDDEN">y9lsmj5jnud.fsf@xxxxxxxxxxxxxxxxxxxxxxxxxxx</a>&gt; &lt;<a href="mailto:opr00jz3dhw2xcd0@DOMAIN.HIDDEN">opr00jz3dhw2xcd0@xxxxxxxxxxxxx</a>&gt; &lt;<a href="mailto:y9lwu89ui2y.fsf@DOMAIN.HIDDEN">y9lwu89ui2y.fsf@xxxxxxxxxxxxxxxxxxxxxxxxxxx</a>&gt; &lt;<a href="mailto:Pine.LNX.4.58.0401031126470.14953@DOMAIN.HIDDEN">Pine.LNX.4.58.0401031126470.14953@xxxxxxxxxxxxxx</a>&gt; &lt;<a href="mailto:vt2zncyhmog.fsf@DOMAIN.HIDDEN">vt2zncyhmog.fsf@xxxxxxxxxx</a>&gt; &lt;<a href="mailto:Pine.LNX.4.58.0401080750010.2668@DOMAIN.HIDDEN">Pine.LNX.4.58.0401080750010.2668@xxxxxxxxxxxxxx</a>&gt; &lt;<a href="mailto:y9lk73q36tj.fsf@DOMAIN.HIDDEN">y9lk73q36tj.fsf@xxxxxxxxxxxxxxxxxxxxxxxxxxx</a>&gt; &lt;<a href="mailto:Pine.LNX.4.58.0401172152370.12895@DOMAIN.HIDDEN">Pine.LNX.4.58.0401172152370.12895@xxxxxxxxxxxxxx</a>&gt; &lt;<a href="mailto:y9lr7xxzhjr.fsf@DOMAIN.HIDDEN">y9lr7xxzhjr.fsf@xxxxxxxxxxxxxxxxxxxxxxxxxxx</a>&gt; &lt;<a href="mailto:200401181621.IAA00813@DOMAIN.HIDDEN">200401181621.IAA00813@xxxxxxxxxxxxxxxxxxxxxxx</a>&gt;</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
<hr>
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre>

On Sun, 18 Jan 2004, Tom Lord wrote:

&gt;    &gt; From: Michael Sperber &lt;sperber@xxxxxxxxxxxxxxxxxxxxxxxxxxx&gt;
&gt;
&gt;    &gt; Ray&gt; It's not immediately obvious to me how to implement some of the
&gt;    &gt; Ray&gt; functionality that's not allowed to GC without allocating call
&gt;    &gt; Ray&gt; frames - particularly since strings are represented internally
&gt;    &gt; Ray&gt; as a tree structure.  I'll look more closely at it tomorrow and
&gt;    &gt; Ray&gt; cite specific cases.
&gt;
&gt;    &gt; As to the strings &amp; characters issue---we all agree that it
&gt;    &gt; needs to be addressed.  But apart from that?


Okay, more specifically:

String representation as a tree means I would need to be able
to allocate call frames (and potentially GC) for string-ref and
string-set (SCHEME_STRING_REF and SCHEME_STRING_SET as they
appear from the C side). That's separate from the character
representation issue.

I can get around most of the other stuff because the call depth
is possible to know in advance, but with the string representation,
the number of frames I'd need to allocate is the length of the
longest path from root to leaf, which isn't known in advance.

&gt; I think &quot;may GC&quot; applies to all entry points.

I tend to agree, but this means no live C pointers directly at
storage occupied by scheme data.

&gt; Even something banal like &quot;extract_double&quot; may wind up having to
&gt; reduce a number by running Scheme code (as in a bignum rational with
&gt; bignums implemented in Scheme (or just on the Scheme heap) or a
&gt; continued fraction numeric extension written in Scheme).

Depends, probably, on rational representation issues.  It's
possible, for me at least, to bitmask &amp; shift the first three
words of the numerator and the first three words of the denominator
to derive C doubles by bitfiddling, then do an FPU division and
return a C double without running scheme code.  I'd normally
run scheme code as accessors, since rationals differ by only a
typetag from cons pairs, but can't without risking GC. The problem
is surmountable since I know in advance the exact depth of
the call stack I'm going to need (one frame, first for car and
then for cdr). I can preallocate it before starting and so avoid
GC during the call.

But these methods heavily depend on the rational representation,
so in general, you're right.


&gt;I think we've cooked down the implications of some FFI design space
&gt;parameters to this:
&gt;
&gt;
&gt;   Parameter			Restricting		Resulting
&gt;				Choice			Restriction
&gt;   ----------------------------------------------------------------
&gt;
&gt;   A. GC only at certain	Yes		Aynchronous threads may
&gt;      C sequence points?			not cause GC;  signal
&gt;                                        	handlers may not cause
&gt;                                                GC
&gt;
&gt;   B. Scheme values		Yes		Requires A
&gt;      repesented as
&gt;      C rvalues?
&gt;
&gt;   C. Barrierless reads		Yes		Certain incremental GC
&gt;      and writes to Scheme			techniques prohibited;
&gt;      locations?				Requires A and B

I would say that this is an excellent summary.  Barrierless reads (C)
are probably the biggest problem here as far as I'm concerned.  I
could live with sequence-point GC (A).

&gt;Supposing that your choice is (A+B) or (A+B+C), then there's a new
&gt;parameter which is what you're asking Ray about:
&gt;
&gt;
&gt;   D. Some FFI functions may	Yes		Scheme types not extensible
&gt;      not cause GC                              in Scheme;
&gt;                                                Some scheme types or procedures
&gt;                                                not implementable in terms
&gt;                                                of others;
&gt;                                                (Implies A, of course)

I think you've hit the nail on the head here.  Using scheme
code to handle the representations is out if you can't
allocate scheme call frames in order to manipulate those
representations from C.  It becomes a sort of callback
even though not an explicit one.


				Bear



</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
<hr>
<ul><li><strong>Follow-Ups</strong>:
<ul>
<li><strong><a name="00339" href="msg00339.html">Re: Couple things...</a></strong>
<ul><li><em>From:</em> Tom Lord</li></ul></li>
</ul></li></ul>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00004" href="msg00004.html">Couple things...</a></strong>
<ul><li><em>From:</em> felix</li></ul></li>
<li><strong><a name="00025" href="msg00025.html">Re: Couple things...</a></strong>
<ul><li><em>From:</em> Michael Sperber</li></ul></li>
<li><strong><a name="00053" href="msg00053.html">Re: Couple things...</a></strong>
<ul><li><em>From:</em> felix</li></ul></li>
<li><strong><a name="00070" href="msg00070.html">Re: Couple things...</a></strong>
<ul><li><em>From:</em> Michael Sperber</li></ul></li>
<li><strong><a name="00102" href="msg00102.html">Re: Couple things...</a></strong>
<ul><li><em>From:</em> felix</li></ul></li>
<li><strong><a name="00108" href="msg00108.html">Re: Couple things...</a></strong>
<ul><li><em>From:</em> Michael Sperber</li></ul></li>
<li><strong><a name="00115" href="msg00115.html">Re: Couple things...</a></strong>
<ul><li><em>From:</em> felix</li></ul></li>
<li><strong><a name="00133" href="msg00133.html">Re: Couple things...</a></strong>
<ul><li><em>From:</em> Michael Sperber</li></ul></li>
<li><strong><a name="00135" href="msg00135.html">Re: Couple things...</a></strong>
<ul><li><em>From:</em> bear</li></ul></li>
<li><strong><a name="00226" href="msg00226.html">Re: Couple things...</a></strong>
<ul><li><em>From:</em> Jim Blandy</li></ul></li>
<li><strong><a name="00230" href="msg00230.html">Re: Couple things...</a></strong>
<ul><li><em>From:</em> bear</li></ul></li>
<li><strong><a name="00334" href="msg00334.html">Re: Couple things...</a></strong>
<ul><li><em>From:</em> Michael Sperber</li></ul></li>
<li><strong><a name="00335" href="msg00335.html">Re: Couple things...</a></strong>
<ul><li><em>From:</em> bear</li></ul></li>
<li><strong><a name="00336" href="msg00336.html">Re: Couple things...</a></strong>
<ul><li><em>From:</em> Michael Sperber</li></ul></li>
<li><strong><a name="00337" href="msg00337.html">Re: Couple things...</a></strong>
<ul><li><em>From:</em> Tom Lord</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
<ul>
<li>Prev by Date:
<strong><a href="msg00337.html">Re: Couple things...</a></strong>
</li>
<li>Next by Date:
<strong><a href="msg00339.html">Re: Couple things...</a></strong>
</li>
<li>Previous by thread:
<strong><a href="msg00337.html">Re: Couple things...</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg00339.html">Re: Couple things...</a></strong>
</li>
<li>Index(es):
<ul>
<li><a href="maillist.html#00338"><strong>Date</strong></a></li>
<li><a href="threads.html#00338"><strong>Thread</strong></a></li>
</ul>
</li>
</ul>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
</body>
</html>
