<!-- MHonArc v2.6.16 -->
<!--X-Subject: Re: datum comments of sweet&#45;expressions -->
<!--X-From-R13: "Rnivq O. Iurryre" <qjurryreNqjurryre.pbz> -->
<!--X-Date: Thu, 25 Jul 2013 00:20:27 +0200 (MST) -->
<!--X-Message-Id: E1V27Q0&#45;000477&#45;BF@rmm6prod02.runbox.com -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: E1UxhRY&#45;0006HV&#45;2W@rmm6prod02.runbox.com -->
<!--X-Head-End-->
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
        "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Re: datum comments of sweet-expressions</title>
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<hr>
[<a href="msg00201.html">Date Prev</a>][<a href="msg00203.html">Date Next</a>][<a href="msg00201.html">Thread Prev</a>][<a href="msg00205.html">Thread Next</a>][<a href="maillist.html#00202">Date Index</a>][<a href="threads.html#00202">Thread Index</a>]
<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h1>Re: datum comments of sweet-expressions</h1>
<p style="max-width: 30em;">This page is part of the web mail archives of <a href="http://srfi.schemers.org/srfi-110">SRFI 110</a> from before July 7th, 2015.  The new archives for SRFI 110 are <a href="http://srfi-email.schemers.org/srfi-110/">here</a>.  The new archives contain all messages, not just those from before July 7th, 2015.</p>
<hr>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul>
<li><em>To</em>: &quot;readable-discuss&quot; &lt;<a href="mailto:readable-discuss@DOMAIN.HIDDEN">readable-discuss@xxxxxxxxxxxxxxxxxxxxx</a>&gt;, &quot;srfi-110&quot; &lt;<a href="mailto:srfi-110@DOMAIN.HIDDEN">srfi-110@xxxxxxxxxxxxxxxxx</a>&gt;</li>
<li><em>Subject</em>: Re: datum comments of sweet-expressions</li>
<li><em>From</em>: &quot;David A. Wheeler&quot; &lt;<a href="mailto:dwheeler@DOMAIN.HIDDEN">dwheeler@xxxxxxxxxxxx</a>&gt;</li>
<li><em>Date</em>: Wed, 24 Jul 2013 18:20:24 -0400 (EDT)</li>
<li><em>Delivered-to</em>: <a href="mailto:srfi-110@DOMAIN.HIDDEN">srfi-110@xxxxxxxxxxxxxxxxx</a></li>
<li><em>In-reply-to</em>: &lt;<a href="mailto:E1UxhRY-0006HV-2W@DOMAIN.HIDDEN">E1UxhRY-0006HV-2W@xxxxxxxxxxxxxxxxxxxxx</a>&gt;</li>
<li><em>Reply-to</em>: <a href="mailto:dwheeler@DOMAIN.HIDDEN">dwheeler@xxxxxxxxxxxx</a></li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
<hr>
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre>I've modified the ANTLR grammar to support datum comments
of the form &quot;#;&quot;+space|tab, at the beginning of the line.  To do this:
* Productions can generate &quot;empty&quot;, which means instead of just list/cons/append
   we need variants in actions that can handle &quot;empty&quot;.  That causes many changes, but
   they're all pretty obvious, e.g., &quot;cons&quot; becomes &quot;conse&quot; (cons handling empty).
* A new terminal DATUM_COMMENTW is generated by &quot;#;&quot; followed by whitespace
   (and like the others doesn't consume the EOL) when we're in indent_processing mode.
* Several rules need to handle the new terminal.  The t_expr recurses to the &quot;real&quot; new
   rule t_expr_real if it get an empty result, and other minor changes handle it.
   Below is a summary.

Does this seem like the right direction?  If so, the next step is to implement
this in Scheme (and in Common Lisp).  This creates a requirement to &quot;take over&quot;
parts of the n-expression reader, unfortunately, but it does create useful functionality
(commenting datum blocks).

--- David A. Wheeler



================================================


@@ -1017,7 +1084,9 @@ collecting_tail returns [Object v]
 
 // Process line after &quot;. hspace+&quot; sequence.  Does not go past current line.
 post_period returns [Object v]
-  : scomment hspace* rpt=post_period {$v = $rpt.v;} // (scomment hspace*)*
+  : DATUM_COMMENTW hspace*
+      (ignored=n_expr hspace* sp2=post_period {$v = $sp2.v;} | /*empty*/ error )
+    | scomment hspace* rpt=post_period {$v = $rpt.v;} // (scomment hspace*)*
     | pn=n_expr hspace* (scomment hspace*)* (n_expr error)? {$v = $pn.v;}
     | COLLECTING hspace* pc=collecting_tail hspace*
       (scomment hspace*)* (n_expr error)? {$v = $pc.v;}

@@ -1066,6 +1135,8 @@ rest returns [Object v]
   : PERIOD /* Improper list */
       (hspace+  pp=post_period {$v = $pp.v;}
        | /*empty*/   {$v = list(&quot;.&quot;);})
+  | DATUM_COMMENTW hspace*
+    (ignored=n_expr hspace* sr2=rest {$v = $sr2.v;} | /*empty*/ error )
   | scomment hspace* (sr=rest {$v = $sr.v;} | /*empty*/ {$v = null;} )
   | COLLECTING hspace* collecting_tail hspace*
     (rr=rest             {$v = cons($collecting_tail.v, $rr.v);}

@@ -1088,9 +1159,11 @@ body returns [Object v]
      (same
        ( {isperiodp($i.v)}? =&gt; f=it_expr DEDENT
            {$v = $f.v;} // Improper list final value
-       | {! isperiodp($i.v)}? =&gt; nxt=body
-           {$v = cons($i.v, $nxt.v);} )
-     | DEDENT {$v = list($i.v);} ) ;
+       | {$i.v == empty}? =&gt; retry=body
+           {$v = $retry.v;}
+       | {!isperiodp($i.v) &amp;&amp; ($i.v != empty)}? =&gt; nxt=body
+           {$v = conse($i.v, $nxt.v);} )
+     | DEDENT {$v = list1e($i.v);} ) ;
 
@@ -1128,22 +1201,21 @@ normal_it_expr returns [Object v]
 // An it_expr with a special prefix like \\ or $:
 
 special_it_expr returns [Object v]
-  : (GROUP_SPLIT | scomment) hspace* /* Initial; Interpet as group */
+  : DATUM_COMMENTW hspace*
+    (is_i=it_expr | comment_eol INDENT body ) {$v=empty;}
+  | (GROUP_SPLIT | scomment) hspace* /* Initial; Interpet as group */
       (group_i=it_expr {$v = $group_i.v;} /* Ignore initial GROUP/scomment */
        | comment_eol
          (INDENT g_body=body {$v = $g_body.v;} /* Normal GROUP use */
-          | same ( g_i=it_expr {$v = $g_i.v;} /* Plausible separator */
-                   /* Handle #!sweet EOL EOL t_expr */
-                   | comment_eol restart=t_expr {$v = $restart.v;} )
-          | DEDENT error ))
+          | same {$v = empty;} ))
 
 

--- David A. Wheeler

</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
<hr>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00199" href="msg00199.html">Re: datum comments of sweet-expressions</a></strong>
<ul><li><em>From:</em> David A. Wheeler</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
<ul>
<li>Prev by Date:
<strong><a href="msg00201.html">Re: [Readable-discuss] Semantics of single datum with all-empty-children in datum comments of sweet-expressions</a></strong>
</li>
<li>Next by Date:
<strong><a href="msg00203.html">datum comments of sweet-expressions - now implemented in Scheme</a></strong>
</li>
<li>Previous by thread:
<strong><a href="msg00201.html">Re: [Readable-discuss] Semantics of single datum with all-empty-children in datum comments of sweet-expressions</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg00205.html">Proposed grammar change: forbid lines with &gt;1 n-expr that end with &quot;.&quot;</a></strong>
</li>
<li>Index(es):
<ul>
<li><a href="maillist.html#00202"><strong>Date</strong></a></li>
<li><a href="threads.html#00202"><strong>Thread</strong></a></li>
</ul>
</li>
</ul>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
</body>
</html>
